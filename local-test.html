<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Local Test - Realtime Gold & Silver Prices</title>
    
    <!-- Pico CSS Framework -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    
    <!-- Local CSS Files -->
    <link rel="stylesheet" href="css/realtime.css">
    
    <style>
        body {
            background: #f8f9fa;
            padding: 2rem 0;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        .test-header {
            text-align: center;
            margin-bottom: 2rem;
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 3rem;
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .section-title {
            background: #002458;
            color: white;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            font-size: 1.2rem;
            font-weight: 600;
        }
        .controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }
        .control-btn {
            background: #002458;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        .control-btn:hover {
            background: #003366;
            transform: translateY(-1px);
        }
        .control-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        .status {
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            font-weight: 500;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .api-info {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 1rem;
            border-radius: 6px;
            font-family: monospace;
            font-size: 0.85rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>üß™ Local Test - Realtime Gold & Silver Prices</h1>
            <p>‡∏ó‡∏î‡∏™‡∏≠‡∏ö Component ‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô deploy ‡∏Ç‡∏∂‡πâ‡∏ô CDN</p>
            <div class="status info" id="connectionStatus">
                üü° ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö...
            </div>
        </div>

        <!-- Test Controls -->
        <div class="test-section">
            <div class="section-title">
                üéÆ Test Controls
            </div>
            
            <div class="controls">
                <button class="control-btn" onclick="testComponent()">üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö Component</button>
                <button class="control-btn" onclick="testAPI()">üîå ‡∏ó‡∏î‡∏™‡∏≠‡∏ö API Connection</button>
                <button class="control-btn" onclick="stopUpdates()">‚èπÔ∏è ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó</button>
                <button class="control-btn" onclick="startUpdates()">‚ñ∂Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó</button>
                <button class="control-btn" onclick="mockDataTest()" disabled>üö´ Mock Data ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</button>
                <button class="control-btn" onclick="clearComponent()">üóëÔ∏è Clear Component</button>
            </div>

            <div class="api-info">
                <strong>API URLs ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:</strong><br>
                Gold Realtime: <span id="goldRealtimeUrl"></span><br>
                Gold Yesterday: <span id="goldYesterdayUrl"></span><br>
                Silver Realtime: <span id="silverRealtimeUrl"></span><br>
                Silver Yesterday: <span id="silverYesterdayUrl"></span>
            </div>
        </div>

        <!-- Test Component 1: Full -->
        <div class="test-section">
            <div class="section-title">
                üåü Test 1: Full Component (‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠)
            </div>
            <div id="realtime-prices-full"></div>
        </div>

        <!-- Test Component 2: Compact -->
        <div class="test-section">
            <div class="section-title">
                üì± Test 2: Compact Component (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠)
            </div>
            <div id="realtime-prices-compact"></div>
        </div>

        <!-- Test Component 3: Custom Interval -->
        <div class="test-section">
            <div class="section-title">
                ‚è±Ô∏è Test 3: Custom Update Interval (5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
            </div>
            <div id="realtime-prices-custom"></div>
        </div>

        <!-- Debug Console -->
        <div class="test-section">
            <div class="section-title">
                üêõ Debug Console
            </div>
            <div id="debugConsole" style="background: #2c3e50; color: #ecf0f1; padding: 1rem; border-radius: 6px; font-family: monospace; font-size: 0.85rem; height: 200px; overflow-y: auto;">
                === Debug Console ===<br>
                ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö...<br>
            </div>
        </div>
    </div>

    <!-- Load Local Scripts -->
    <script src="scripts/realtime.js"></script>
    
    <script>
        let components = {
            full: null,
            compact: null,
            custom: null
        };

        // Debug logging function
        function debugLog(message) {
            const console = document.getElementById('debugConsole');
            const timestamp = new Date().toLocaleTimeString('th-TH');
            console.innerHTML += `[${timestamp}] ${message}<br>`;
            console.scrollTop = console.scrollHeight;
        }

        // Update status
        function updateStatus(message, type = 'info') {
            const status = document.getElementById('connectionStatus');
            status.className = `status ${type}`;
            status.innerHTML = message;
        }

        // Update API URLs display
        function updateAPIDisplay() {
            if (components.full && components.full.apiUrls) {
                document.getElementById('goldRealtimeUrl').textContent = components.full.apiUrls.goldRealtime;
                document.getElementById('goldYesterdayUrl').textContent = components.full.apiUrls.goldYesterday;
                document.getElementById('silverRealtimeUrl').textContent = components.full.apiUrls.silverRealtime;
                document.getElementById('silverYesterdayUrl').textContent = components.full.apiUrls.silverYesterday;
            }
        }

        // Test component initialization
        function testComponent() {
            try {
                debugLog('üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á Components...');
                
                // Create full component
                components.full = new GemApp.RealtimePriceComponent('realtime-prices-full');
                debugLog('‚úÖ Full component ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à');
                
                // Create compact component
                components.compact = new GemApp.RealtimePriceComponent('realtime-prices-compact', {
                    showTitle: false
                });
                debugLog('‚úÖ Compact component ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à');
                
                // Create custom interval component
                components.custom = new GemApp.RealtimePriceComponent('realtime-prices-custom', {
                    updateInterval: 5000,
                    showTitle: true
                });
                debugLog('‚úÖ Custom interval component ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à (5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)');
                
                updateStatus('üü¢ Components ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß - ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...', 'success');
                updateAPIDisplay();
                
            } catch (error) {
                debugLog(`‚ùå Error: ${error.message}`);
                updateStatus('üî¥ ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á Components', 'error');
            }
        }

        // Test API connection
        async function testAPI() {
            if (!components.full) {
                debugLog('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á Component ‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }

            debugLog('üîå ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ API...');
            updateStatus('üü° ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö API...', 'info');

            try {
                const goldUrl = components.full.apiUrls.goldRealtime;
                const silverUrl = components.full.apiUrls.silverRealtime;

                debugLog(`üì° ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Gold API: ${goldUrl}`);
                const goldResponse = await fetch(goldUrl);
                const goldData = await goldResponse.json();
                debugLog(`‚úÖ Gold API Response: ${JSON.stringify(goldData).substring(0, 100)}...`);

                debugLog(`üì° ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Silver API: ${silverUrl}`);
                const silverResponse = await fetch(silverUrl);
                const silverData = await silverResponse.json();
                debugLog(`‚úÖ Silver API Response: ${JSON.stringify(silverData).substring(0, 100)}...`);

                updateStatus('üü¢ API ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');

            } catch (error) {
                debugLog(`‚ùå API Error: ${error.message}`);
                updateStatus('üî¥ API ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à - ‡πÉ‡∏ä‡πâ Mock Data', 'error');
            }
        }

        // Use mock data - removed as requested
        function mockDataTest() {
            debugLog('üö´ Mock Data ‡∏ñ‡∏π‡∏Å‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô - ‡πÉ‡∏ä‡πâ API ‡∏à‡∏£‡∏¥‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô');
            updateStatus('üö´ Mock Data ‡∏ñ‡∏π‡∏Å‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô', 'info');
        }

        // Stop updates
        function stopUpdates() {
            debugLog('‚èπÔ∏è ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏ó‡∏∏‡∏Å Components');
            Object.values(components).forEach(component => {
                if (component && component.stopRealTimeUpdates) {
                    component.stopRealTimeUpdates();
                }
            });
            updateStatus('‚èπÔ∏è ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÅ‡∏•‡πâ‡∏ß', 'info');
        }

        // Start updates
        function startUpdates() {
            debugLog('‚ñ∂Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÉ‡∏´‡∏°‡πà');
            Object.values(components).forEach(component => {
                if (component && component.startRealTimeUpdates) {
                    component.startRealTimeUpdates();
                }
            });
            updateStatus('‚ñ∂Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡πâ‡∏ß', 'success');
        }

        // Clear components
        function clearComponent() {
            debugLog('üóëÔ∏è ‡∏•‡∏ö Components ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î');
            Object.keys(components).forEach(key => {
                if (components[key] && components[key].destroy) {
                    components[key].destroy();
                }
                components[key] = null;
            });
            updateStatus('üóëÔ∏è ‡∏•‡∏ö Components ‡πÅ‡∏•‡πâ‡∏ß', 'info');
        }

        // Check if script loaded
        document.addEventListener('DOMContentLoaded', function() {
            if (window.GemApp && window.GemApp.RealtimePriceComponent) {
                debugLog('‚úÖ RealtimePriceComponent ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à');
                updateStatus('üü¢ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö', 'success');
            } else {
                debugLog('‚ùå RealtimePriceComponent ‡πÑ‡∏°‡πà‡πÇ‡∏´‡∏•‡∏î');
                updateStatus('üî¥ ‡πÑ‡∏°‡πà‡∏û‡∏ö RealtimePriceComponent', 'error');
            }
        });

        // Auto-start test after page load
        setTimeout(() => {
            if (window.GemApp && window.GemApp.RealtimePriceComponent) {
                debugLog('ü§ñ Auto-starting component test...');
                testComponent();
            }
        }, 1000);
    </script>
</body>
</html>